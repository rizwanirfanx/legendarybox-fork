/*
 * ------------------------------------------------------------
 * IMPORTANT: The contents of this file are auto-generated.
 *
 * This file may be updated by the Shopify admin theme editor
 * or related systems. Please exercise caution as any changes
 * made to this file may be overwritten.
 * ------------------------------------------------------------
 */
{
  "sections": {
    "main": {
      "type": "main-page",
      "disabled": true,
      "settings": {
        "padding_top": 28,
        "padding_bottom": 28
      }
    },
    "custom_liquid_yxKzpk": {
      "type": "custom-liquid",
      "name": "t:sections.custom-liquid.presets.name",
      "settings": {
        "custom_liquid": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n  <title>Caffeine & Legends – Subscription (fully mapped)</title>\n  <style>\n    :root{\n      --brand:#e33b3b; --ink:#0d2331; --muted:#607d8b;\n      --card:#ffffff; --accent:#7ee081;\n      --radius:18px; --shadow:0 10px 24px rgba(0,0,0,.08);\n      --btn-bg:#ffffff; --btn-hover:#f8fbfc; --btn-selected:#fff5f5;\n      --btn-border:#d7e4ea; --btn-border-strong:#b6cbd3;\n      --divider:#6b8793; /* darker mobile divider */\n    }\n\n    /* Scope to avoid theme collisions */\n    .cl-sub * { box-sizing: border-box; }\n    .cl-sub .wrap{max-width:1100px;margin:32px auto;padding:20px}\n    .cl-sub h1{color:var(--ink);text-align:center;margin:8px 0 18px;font-weight:800;letter-spacing:.2px}\n\n    /* Card + grid */\n    .cl-sub .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}\n    .cl-sub .grid{display:grid;gap:16px}\n    @media (min-width:880px){\n      .cl-sub .grid.cols-2{grid-template-columns:1fr 1fr}\n      .cl-sub .grid.cols-3{grid-template-columns:repeat(3,1fr)}\n      .cl-sub .grid.cols-4{grid-template-columns:repeat(4,1fr)}\n    }\n\n    /* Tier cards */\n    .cl-sub .option{border:2px solid #e7eef1;border-radius:14px;padding:16px;cursor:pointer;display:flex;flex-direction:column;gap:8px;transition:all .18s ease;position:relative;background:#fff}\n    .cl-sub .option:hover{border-color:#c9dade;box-shadow:0 6px 18px rgba(3,34,41,.08)}\n    .cl-sub .option.selected{border-color:var(--brand);outline:3px solid var(--brand);outline-offset:3px;box-shadow:0 10px 24px rgba(227,59,59,.12)}\n    .cl-sub .option.promo{border-color:var(--accent);box-shadow:0 12px 28px rgba(126,224,129,.22)}\n    .cl-sub .option h3{margin:0 0 6px 0;font-size:20px}\n    .cl-sub .price{color:var(--muted);font-weight:600;display:flex;flex-direction:column;gap:2px}\n    .cl-sub .price .label{font-size:12px;color:var(--muted)}\n    .cl-sub .price .amount{font-size:24px;color:var(--ink);font-weight:800}\n    .cl-sub .price .suffix{font-size:14px;color:var(--muted);font-weight:600}\n    .cl-sub .subline{font-size:13px;color:#5e6b74;margin-top:2px}\n\n    /* Badges */\n    .cl-sub .badge{\n      position:absolute;background:var(--accent);color:#083b1a;font-weight:800;font-size:11px;\n      padding:6px 10px;border-radius:999px;box-shadow:0 3px 6px rgba(0,0,0,.15);letter-spacing:.5px;white-space:nowrap\n    }\n    .cl-sub .option .badge{right:8px;top:8px}\n    .cl-sub .option.full-experience .badge{top:auto;right:8px;bottom:6px} /* bottom-right for Full Experience */\n    .cl-sub .term .badge{right:8px;bottom:8px}\n    .cl-sub .option.full-experience{padding-bottom:40px}\n    @supports(selector(:has(*))){\n      .cl-sub .option:has(> .badge){padding-bottom:40px}\n    }\n\n    /* Toggle chips */\n    .cl-sub .tier-toggle{display:flex;gap:8px;align-items:center;margin-bottom:12px;flex-wrap:wrap}\n    .cl-sub .tier-toggle .label{font-weight:800;color:#2a3c46;margin-right:4px}\n    .cl-sub .seg{display:flex;background:#f4f7f9;border:2px solid #e7eef1;border-radius:12px;overflow:hidden}\n    .cl-sub .seg button{background:transparent;border:none;padding:10px 14px;cursor:pointer;font-weight:800;color:#46606b}\n    .cl-sub .seg button.active{background:#fff;color:#e33b3b;border:2px solid var(--brand);border-radius:10px;margin:4px}\n\n    /* Terms grid */\n    .cl-sub .terms{display:grid;gap:16px}\n    @media (min-width:640px){.cl-sub .terms{grid-template-columns:repeat(2,1fr)}}\n    @media (min-width:1024px){.cl-sub .terms{grid-template-columns:repeat(4,1fr)}}\n    .cl-sub .term{border:2px solid #e7eef1;border-radius:14px;background:#fff;box-shadow:var(--shadow);padding:16px;display:flex;flex-direction:column;gap:6px;cursor:pointer;transition:border-color .18s, box-shadow .18s;position:relative}\n    .cl-sub .term:hover{border-color:#c9dade;box-shadow:0 6px 18px rgba(3,34,41,.08)}\n    .cl-sub .term.selected{border-color:var(--brand);box-shadow:0 10px 24px rgba(227,59,59,.12)}\n    .cl-sub .t-title{font-weight:800;font-size:18px}\n    .cl-sub .t-price{font-size:22px;font-weight:900;color:var(--ink)}\n    .cl-sub .t-billing{display:flex;flex-direction:column;gap:0}\n    .cl-sub .t-note{font-size:12px;color:#5e6b74;margin:2px 0 0}\n    .cl-sub .t-note.tight{margin-top:0} /* fixes the extra gap on monthly */\n\n    /* Drink step buttons */\n    .cl-sub #step-2 .controls{display:flex;flex-direction:column;gap:10px}\n    .cl-sub .drink-label{font-weight:800;color:#2a3c46}\n    .cl-sub .drink-group{display:flex;flex-wrap:wrap;gap:10px}\n    .cl-sub .drink-btn{\n      border:2px solid var(--btn-border); background:var(--btn-bg); border-radius:14px;\n      padding:12px 16px; cursor:pointer; font-weight:800; color:#2a3c46;\n      box-shadow:0 1px 3px rgba(0,0,0,.04);\n      transition:border-color .18s, box-shadow .18s, background .18s;\n      min-width:120px;\n    }\n    .cl-sub .drink-btn:hover{background:var(--btn-hover);border-color:var(--btn-border-strong);box-shadow:0 4px 12px rgba(0,0,0,.08)}\n    .cl-sub .drink-btn[aria-pressed=\"true\"]{border-color:var(--brand);background:var(--btn-selected);box-shadow:0 6px 16px rgba(227,59,59,.16)}\n\n    /* Two-drink layout & mobile divider */\n    .cl-sub #drink-form.grid.cols-2{grid-template-columns:1fr 1fr;position:relative}\n    .cl-sub .drink-col{padding:0 8px}\n    @media (max-width:640px){\n      .cl-sub #drink-form.grid.cols-2::before{\n        content:\"\";position:absolute;top:0;bottom:0;left:50%;width:1px;background:var(--divider)\n      }\n      .cl-sub .drink-group{flex-direction:column}\n      .cl-sub .drink-btn{width:100%;min-width:0;padding:14px 18px;font-size:16px}\n    }\n\n    /* VIP */\n    .cl-sub .vip{display:flex;align-items:start;gap:12px;border-top:1px dashed #e7eef1;margin-top:14px;padding-top:14px;position:relative}\n    .cl-sub .vip small{color:#5e6b74}\n    .cl-sub .vip .vip-info{background:transparent;border:none;color:#104854;text-decoration:underline;cursor:pointer;font-size:12px;padding:0;margin-left:6px}\n    .cl-sub .vip-popover{position:absolute;right:0;bottom:calc(100% + 10px);z-index:30;background:#ffffff;border:1px solid #e7eef1;border-radius:12px;box-shadow:0 12px 28px rgba(0,0,0,.12);padding:14px;max-width:520px;width:min(92vw,520px);max-height:min(70vh,420px);overflow:auto;display:none}\n    .cl-sub .vip-popover.open{display:block}\n\n    /* Buttons / hints */\n    .cl-sub .cta{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:12px}\n    .cl-sub .btn{background:var(--brand);color:#fff;border:none;border-radius:999px;padding:14px 22px;font-weight:800;letter-spacing:.3px;cursor:pointer}\n    .cl-sub .btn.secondary{background:#ffffff;color:var(--brand);border:2px solid var(--brand)}\n    .cl-sub .hint{color:#99b0b8;font-size:13px;text-align:center;margin-top:10px} /* slightly darker hint */\n\n    .cl-sub .hidden{display:none}\n\n    /* Toast */\n    .cl-sub .toast{\n      position: fixed; right: 16px; bottom: 16px; z-index: 9999;\n      background:#083b1a; color:#fff; padding:10px 14px; border-radius:12px;\n      box-shadow:0 10px 24px rgba(0,0,0,.2);\n      opacity:0; transform:translateY(8px); transition:opacity .18s, transform .18s;\n      font-weight:700; letter-spacing:.2px; font-size:14px;\n    }\n    .cl-sub .toast.show{ opacity:1; transform:translateY(0); }\n  </style>\n</head>\n<body>\n  <div class=\"cl-sub\">\n    <div class=\"wrap\">\n      <h1>Choose Your Subscription</h1>\n\n      <!-- STEP 1: Tier -->\n      <section class=\"card\" id=\"step-1\">\n        <div class=\"grid cols-3\">\n          <div class=\"option\" data-tier=\"one\">\n            <h3>Standard</h3>\n            <div class=\"price\">\n              <span class=\"label\">Starting at</span>\n              <span class=\"amount\">$39.99<span class=\"suffix\"> /box + s/h</span></span>\n            </div>\n            <small>1 full-size drink each month</small>\n            <div class=\"subline\">Great for solo readers.</div>\n          </div>\n\n          <div class=\"option\" data-tier=\"two\">\n            <h3>Two Drinks Each Month</h3>\n            <div class=\"price\">\n              <span class=\"label\">Starting at</span>\n              <span class=\"amount\">$58.99<span class=\"suffix\"> /box + s/h</span></span>\n            </div>\n            <small>2 full-size drinks each month</small>\n            <div class=\"subline\">Best value for duos or caffeine fiends.</div>\n          </div>\n\n        <div class=\"option promo full-experience\" data-tier=\"three\">\n            <span class=\"badge\">Free Drink Scoop</span>\n            <h3>The Full Experience</h3>\n            <div class=\"price\">\n              <span class=\"label\">Starting at</span>\n              <span class=\"amount\">$64.99<span class=\"suffix\"> /box + s/h</span></span>\n            </div>\n            <small>3 full-size drinks each month</small>\n            <div class=\"subline\">Coffee + Tea + Drinking Chocolate.</div>\n          </div>\n        </div>\n        <div class=\"cta\">\n          <button class=\"btn\" id=\"to-step-2\" disabled>Continue →</button>\n          <span class=\"hint\">Select a tier to continue</span>\n        </div>\n      </section>\n\n      <!-- STEP 2: Drinks -->\n      <section class=\"card hidden\" id=\"step-2\">\n        <div class=\"tier-toggle\" id=\"toggle-2\">\n          <span class=\"label\">Plan:</span>\n          <div class=\"seg\">\n            <button type=\"button\" data-tier=\"one\" class=\"active\">1 Drink</button>\n            <button type=\"button\" data-tier=\"two\">2 Drinks</button>\n            <button type=\"button\" data-tier=\"three\">Full Box (3)</button>\n          </div>\n        </div>\n\n        <div id=\"drink-form\" class=\"grid\"></div>\n        <div class=\"cta\">\n          <button class=\"btn secondary\" id=\"back-1\">← Back</button>\n          <button class=\"btn\" id=\"to-step-3\" disabled>Continue →</button>\n          <span class=\"hint\">Complete your selections to continue</span>\n        </div>\n      </section>\n\n      <!-- STEP 3: Term + VIP -->\n      <section class=\"card hidden\" id=\"step-3\">\n        <div class=\"tier-toggle\" id=\"toggle-3\">\n          <span class=\"label\">Plan:</span>\n          <div class=\"seg\">\n            <button type=\"button\" data-tier=\"one\" class=\"active\">1 Drink</button>\n            <button type=\"button\" data-tier=\"two\">2 Drinks</button>\n            <button type=\"button\" data-tier=\"three\">Full Box (3)</button>\n          </div>\n        </div>\n\n        <div class=\"terms\" id=\"terms\"></div>\n\n        <label class=\"vip\">\n          <input type=\"checkbox\" id=\"vip-toggle\" />\n          <div>\n            <strong>🔮 Unlock Legendary Access — join the C&L VIP program</strong>\n            <small>$10/month — billed monthly.\n              <button type=\"button\" class=\"vip-info\" id=\"vip-info-btn\">What’s included in Legendary Access?</button>\n            </small>\n            <div class=\"vip-popover\" id=\"vip-popover\" role=\"dialog\" aria-modal=\"false\" aria-labelledby=\"vip-pop-title\">\n              <h4 id=\"vip-pop-title\">🔮 LEGENDARY ACCESS 🔮</h4>\n              <p>Join an exclusive community where your voice shapes the magic.</p>\n              <ul>\n                <li>🗳️ <strong>Your Voice Matters</strong> — vote on upcoming books, drinks, and bonus items.</li>\n                <li>💎 <strong>$10 Monthly Credits</strong> — for our members-only secret store (expire in 30 days).</li>\n                <li>✨ <strong>VIP Experiences</strong> — monthly live Q&As with authors & creators.</li>\n                <li>📜 <strong>Insider Access</strong> — members-only newsletter.</li>\n                <li>🎁 <strong>Golden Ticket Giveaways</strong> — monthly surprise for one member.</li>\n                <li>💰 <strong>Referral Rewards</strong> — give $15, get $15.</li>\n              </ul>\n              <button type=\"button\" class=\"btn secondary vip-close\" id=\"vip-pop-close\">Close</button>\n            </div>\n          </div>\n        </label>\n\n        <div class=\"cta\">\n          <button class=\"btn secondary\" id=\"back-2\">← Back</button>\n          <button class=\"btn\" id=\"add-to-cart\">Add to Cart</button>\n          <span class=\"hint\" id=\"cta-hint\">Adds your plan (and VIP if selected) to the cart.</span>\n        </div>\n      </section>\n    </div>\n  </div>\n\n  <script>\n    (function onReady(fn){ if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',fn);} else {fn();} })(function init(){\n      /* ===== CONFIG (ALL terms fully mapped) ===== */\n      const CONFIG = {\n        oneDrink: {\n          /* Monthly */\n          monthly: {\n            sellingPlanId: 3626041567,\n            monthlyMap: {\n              'Coffee':              32035742220332,\n              'Tea':                 32035742285868,\n              'Drinking Chocolate':  42389866217695,\n              'Surprise Me':         43273685467359, // Roulette monthly\n            }\n          },\n          /* 3-Month (Roulette -> Surprise Me) */\n          three: {\n            sellingPlanId: 3626074335,\n            monthlyMap: {\n              'Coffee':              32092953313324,\n              'Tea':                 32092953346092,\n              'Drinking Chocolate':  42394298515679,\n              'Surprise Me':         43273694740703, // Roulette\n            }\n          },\n          /* 6-Month */\n          six: {\n            sellingPlanId: 3625943263,\n            monthlyMap: {\n              'Coffee':              37261724221601,\n              'Tea':                 37261724254369,\n              'Drinking Chocolate':  43273696837855,\n              'Surprise Me':         43273696968927, // Roulette\n            }\n          },\n          /* 12-Month */\n          twelve: {\n            sellingPlanId: 4130799839,\n            monthlyMap: {\n              'Coffee':              46452095713503,\n              'Tea':                 46452095746271,\n              'Drinking Chocolate':  46452095779039,\n              'Surprise Me':         46452095942879, // Roulette\n            }\n          },\n        },\n\n        twoDrinks: {\n          /* Monthly */\n          monthly: {\n            sellingPlanId: 3626041567,\n            monthlyMap: {\n              'Coffee + Coffee':                         47413442674911,\n              'Coffee + Tea':                            32035742384172,\n              'Coffee + Drinking Chocolate':             44630664413407,\n              'Tea + Tea':                               47413442707679,\n              'Tea + Drinking Chocolate':                44645342871775,\n              'Drinking Chocolate + Drinking Chocolate': 47413442740447,\n            }\n          },\n          /* 3-Month */\n          three: {\n            sellingPlanId: 3626074335,\n            monthlyMap: {\n              'Coffee + Coffee':                         47413446246623,\n              'Coffee + Tea':                            32092953378860,\n              'Coffee + Drinking Chocolate':             44630670541023,\n              'Tea + Tea':                               47413446279391,\n              'Tea + Drinking Chocolate':                44376349180127,\n              'Drinking Chocolate + Drinking Chocolate': 47413446312159,\n            }\n          },\n          /* 6-Month */\n          six: {\n            sellingPlanId: 3625943263,\n            monthlyMap: {\n              'Coffee + Coffee':                         47413445820639,\n              'Coffee + Tea':                            37261724287137,\n              'Coffee + Drinking Chocolate':             44630671327455,\n              'Tea + Tea':                               47413445853407,\n              'Tea + Drinking Chocolate':                44376578261215,\n              'Drinking Chocolate + Drinking Chocolate': 47413445886175,\n            }\n          },\n          /* 12-Month */\n          twelve: {\n            sellingPlanId: 4130799839,\n            monthlyMap: {\n              'Coffee + Coffee':                         47413441528031,\n              'Coffee + Tea':                            46452095811807,\n              'Coffee + Drinking Chocolate':             46452096008415,\n              'Tea + Tea':                               47413441560799,\n              'Tea + Drinking Chocolate':                46452095844575,\n              'Drinking Chocolate + Drinking Chocolate': 47413441593567,\n            }\n          },\n        },\n\n        /* Full Experience (3-drink) */\n        threeDrinks: {\n          monthly: {\n            sellingPlanId: 3626041567,\n            monthlyMap: { 'Full Box': 47428291920095 }\n          },\n          three:   { variantId: 47428290871519, sellingPlanId: 3626074335 },\n          six:     { variantId: 47428289396959, sellingPlanId: 3625943263 },\n          twelve:  { variantId: 47428284514527, sellingPlanId: 4130799839 },\n        },\n\n        vip: { variantId: 46994096718047, sellingPlanId: 4464738527 }\n      };\n\n      /* Toast + open cart (works with standard Shopify cart) */\n      function showToast(msg){\n        const root = document.querySelector('.cl-sub'); if(!root) return;\n        let t = root.querySelector('.toast');\n        if(!t){ t = document.createElement('div'); t.className='toast'; t.setAttribute('role','status'); t.setAttribute('aria-live','polite'); root.appendChild(t); }\n        t.textContent = msg; t.classList.add('show');\n        clearTimeout(t._hideTimer); t._hideTimer = setTimeout(()=>t.classList.remove('show'), 2500);\n      }\n      function openCartDrawer(){\n        showToast('Added to cart — opening cart…');\n        try{\n          document.dispatchEvent(new CustomEvent('cart:open'));\n          document.dispatchEvent(new CustomEvent('theme:cart:open'));\n          document.dispatchEvent(new CustomEvent('drawer:open',{detail:{id:'cart'}}));\n          if(window.jQuery){ jQuery(document).trigger('cart:open'); jQuery(document).trigger('theme:cart:open'); }\n        }catch(_){}\n        setTimeout(()=>{ window.location.assign('/cart'); }, 150);\n      }\n\n      /* ===== STATE ===== */\n      const state = { tier:null, drink1:null, drink2:null, term:'monthly' };\n\n      /* ===== HELPERS ===== */\n      function setActiveStep(n){ [1,2,3].forEach(i=>document.getElementById('step-'+i).classList.toggle('hidden', i!==n)); }\n\n      function syncToggleUI(){\n        ['toggle-2','toggle-3'].forEach(id=>{\n          const wrap = document.getElementById(id); if(!wrap) return;\n          wrap.querySelectorAll('button[data-tier]').forEach(b=>{\n            b.classList.toggle('active', b.getAttribute('data-tier')===state.tier);\n          });\n        });\n        document.querySelectorAll('.cl-sub #step-1 .option').forEach(o=>{\n          o.classList.toggle('selected', o.getAttribute('data-tier')===state.tier);\n        });\n      }\n\n      function attachToggleHandlers(){\n        ['toggle-2','toggle-3'].forEach(id=>{\n          const wrap = document.getElementById(id); if(!wrap) return;\n          wrap.addEventListener('click', e=>{\n            const btn = e.target.closest('button[data-tier]'); if(!btn) return;\n            const newTier = btn.getAttribute('data-tier'); if(newTier===state.tier) return;\n            state.tier = newTier; state.drink1=null; state.drink2=null; syncToggleUI();\n            const needs = (state.tier==='one' && !state.drink1) ||\n                          (state.tier==='two' && (!state.drink1 || !state.drink2));\n            if(id==='toggle-3' && needs){ renderDrinkStep(); setActiveStep(2); return; }\n            if(id==='toggle-2'){ renderDrinkStep(); }\n            if(id==='toggle-3'){ renderTerms(); }\n          });\n        });\n      }\n\n      /* ===== Step 1: Tier ===== */\n      const step1 = document.getElementById('step-1');\n      const btnToStep2 = document.getElementById('to-step-2');\n\n      step1.addEventListener('click', e=>{\n        const opt = e.target.closest('.option'); if(!opt) return;\n        step1.querySelectorAll('.option').forEach(o=>o.classList.remove('selected'));\n        opt.classList.add('selected');\n        state.tier = opt.getAttribute('data-tier');\n        state.drink1 = null; state.drink2 = null;\n        btnToStep2.disabled = false;\n        syncToggleUI();\n      });\n\n      btnToStep2.addEventListener('click', ()=>{\n        syncToggleUI();\n        if(state.tier==='three'){\n          // Skip drink step for Full Experience\n          state.drink1='Coffee'; state.drink2='Tea'; state.drink3='Drinking Chocolate';\n          renderTerms(); setActiveStep(3);\n        } else {\n          renderDrinkStep(); setActiveStep(2);\n        }\n      });\n\n      /* ===== Step 2: Drink selection ===== */\n      const DRINK_OPTIONS_ALL = ['Coffee','Tea','Drinking Chocolate','Surprise Me'];\n      const DRINK_OPTIONS_NO_SURPRISE = ['Coffee','Tea','Drinking Chocolate']; // for 2-drink\n\n      function createDrinkButtons(id, heading, options, selectedValue){\n        const column = document.createElement('div');\n        column.className = 'drink-col';\n        const wrap = document.createElement('div');\n        wrap.className = 'controls';\n        wrap.id = id+'-wrap';\n        wrap.dataset.selected = selectedValue || '';\n        const label = document.createElement('div');\n        label.className = 'drink-label';\n        label.textContent = heading;\n        const group = document.createElement('div');\n        group.className = 'drink-group';\n        options.forEach(opt=>{\n          const btn = document.createElement('button');\n          btn.type='button'; btn.className='drink-btn'; btn.textContent=opt;\n          btn.setAttribute('aria-pressed', String(opt===selectedValue));\n          btn.addEventListener('click', ()=>{\n            group.querySelectorAll('.drink-btn').forEach(b=>b.setAttribute('aria-pressed','false'));\n            btn.setAttribute('aria-pressed','true');\n            wrap.dataset.selected = opt;\n            validateDrinkStep();\n          });\n          group.appendChild(btn);\n        });\n        wrap.appendChild(label); wrap.appendChild(group);\n        column.appendChild(wrap);\n        return column;\n      }\n\n      function renderDrinkStep(){\n        const form = document.getElementById('drink-form');\n        form.innerHTML = '';\n        if(state.tier==='two'){\n          form.className = 'grid cols-2';\n          form.appendChild(createDrinkButtons('drink-one','Choose 1st Drink',DRINK_OPTIONS_NO_SURPRISE,state.drink1));\n          form.appendChild(createDrinkButtons('drink-two','Choose 2nd Drink',DRINK_OPTIONS_NO_SURPRISE,state.drink2));\n        } else if(state.tier==='one'){\n          form.className = 'grid';\n          form.appendChild(createDrinkButtons('drink-single','Choose your drink',DRINK_OPTIONS_ALL,state.drink1));\n        } else {\n          form.className = 'grid';\n          const box = document.createElement('div'); box.className='controls';\n          box.innerHTML = '<div class=\"drink-label\">Full Box Contents</div><div class=\"subline\">Coffee + Tea + Drinking Chocolate (no selection needed)</div>';\n          form.appendChild(box);\n        }\n        validateDrinkStep();\n      }\n\n      function validateDrinkStep(){\n        const btn = document.getElementById('to-step-3');\n        if(state.tier==='two'){\n          const a = document.getElementById('drink-one-wrap')?.dataset.selected || '';\n          const b = document.getElementById('drink-two-wrap')?.dataset.selected || '';\n          btn.disabled = !(a && b);\n        } else if(state.tier==='one'){\n          const s = document.getElementById('drink-single-wrap')?.dataset.selected || '';\n          btn.disabled = !s;\n        } else {\n          btn.disabled = false;\n        }\n      }\n\n      document.getElementById('back-1').addEventListener('click', ()=> setActiveStep(1));\n      document.getElementById('to-step-3').addEventListener('click', ()=>{\n        if(state.tier==='two'){\n          state.drink1 = document.getElementById('drink-one-wrap').dataset.selected || null;\n          state.drink2 = document.getElementById('drink-two-wrap').dataset.selected || null;\n        } else if(state.tier==='one'){\n          state.drink1 = document.getElementById('drink-single-wrap').dataset.selected || null;\n        } else {\n          state.drink1='Coffee'; state.drink2='Tea'; state.drink3='Drinking Chocolate';\n        }\n        syncToggleUI(); renderTerms(); setActiveStep(3);\n      });\n\n      /* ===== Step 3: Term cards (pricing display) ===== */\n      function formatMoney(n){ return '$' + Number(n).toFixed(2); }\n      function monthsLabel(m){ return m===1 ? 'monthly' : ('every ' + m + ' months'); }\n\n      function renderTerms(){\n        const container = document.getElementById('terms');\n        container.innerHTML = '';\n\n        // 1-Drink pricing\n        const one = [\n          {key:'monthly', title:'Monthly Plan',     perBox:44.99, months:1},\n          {key:'three',   title:'3-Month Prepaid',  perBox:42.99, months:3},\n          {key:'six',     title:'6-Month Prepaid',  perBox:41.99, months:6},\n          {key:'twelve',  title:'12-Month Prepaid', perBox:39.99, months:12}\n        ];\n        // 2-Drink pricing (given totals -> derive per box)\n        const two = [\n          {key:'monthly', title:'Monthly Plan',     total: 64.99, months:1},\n          {key:'three',   title:'3-Month Prepaid',  total:188.97, months:3},\n          {key:'six',     title:'6-Month Prepaid',  total:365.94, months:6},\n          {key:'twelve',  title:'12-Month Prepaid', total:707.88, months:12}\n        ];\n        // 3-Drink pricing\n        const three = [\n          {key:'monthly', title:'Monthly Plan',     perBox:69.99, total: 69.99, months:1},\n          {key:'three',   title:'3-Month Prepaid',  perBox:68.99, total:206.97, months:3},\n          {key:'six',     title:'6-Month Prepaid',  perBox:66.99, total:401.94, months:6},\n          {key:'twelve',  title:'12-Month Prepaid', perBox:64.99, total:779.88, months:12}\n        ];\n\n        let rows;\n        if(state.tier==='two'){\n          rows = two.map(r => ({ key:r.key, title:r.title, perBox:(r.total/r.months), total:r.total, months:r.months }));\n        } else if(state.tier==='three'){\n          rows = three.map(r => ({ key:r.key, title:r.title, perBox:r.perBox, total:r.total, months:r.months }));\n        } else {\n          rows = one.map(r => ({ key:r.key, title:r.title, perBox:r.perBox, total:(r.perBox*r.months), months:r.months }));\n        }\n\n        rows.forEach(row=>{\n          const combinedTotal = row.months>1\n            ? `Total ${formatMoney(row.total)} billed ${monthsLabel(row.months)} + Shipping`\n            : `Total ${formatMoney(row.total)} billed ${monthsLabel(row.months)}`;\n\n          const el = document.createElement('div');\n          el.className = 'term';\n          el.dataset.term = row.key;\n\n          // Free Scoop: show on all prepaids (3/6/12), plus monthly when Full Experience is selected\n          const showScoop = (row.months>1) || (state.tier==='three' && row.months===1);\n          if(showScoop){\n            const badge = document.createElement('span');\n            badge.className = 'badge';\n            badge.textContent = 'Free Scoop';\n            el.appendChild(badge);\n          }\n\n          el.innerHTML += `\n            <div class=\"t-title\">${row.title}</div>\n            <div class=\"t-price\">${formatMoney(row.perBox)}/box</div>\n            <div class=\"t-billing\">\n              <div class=\"t-note\">${combinedTotal}</div>\n              ${row.months===1 ? '<div class=\"t-note tight\">+ Shipping</div>' : ''}\n            </div>\n          `;\n\n          if(row.key===state.term) el.classList.add('selected');\n          el.addEventListener('click', ()=>{\n            container.querySelectorAll('.term').forEach(t=>t.classList.remove('selected'));\n            el.classList.add('selected');\n            state.term = row.key;\n          });\n          container.appendChild(el);\n        });\n      }\n\n      /* ===== Variant resolver (uses per-selection maps for any term) ===== */\n      const DRINK_ORDER = { 'Coffee':1, 'Tea':2, 'Drinking Chocolate':3 };\n      function normalizePair(a,b){ return (DRINK_ORDER[a] <= DRINK_ORDER[b]) ? `${a} + ${b}` : `${b} + ${a}`; }\n\n      function getVariantAndPlan(){\n        const tierKey =\n          state.tier === 'two'   ? 'twoDrinks' :\n          state.tier === 'three' ? 'threeDrinks' :\n                                    'oneDrink';\n\n        const termCfg = CONFIG[tierKey][state.term];\n        if(!termCfg) return null;\n\n        let variantId = termCfg.variantId || null;\n        let sellingPlanId = termCfg.sellingPlanId || null;\n\n        // If a per-selection map exists (monthlyMap), use it for ANY term.\n        if(termCfg.monthlyMap){\n          if(tierKey === 'oneDrink'){\n            variantId = termCfg.monthlyMap[state.drink1] || null;\n          } else if(tierKey === 'twoDrinks'){\n            variantId = termCfg.monthlyMap[ normalizePair(state.drink1, state.drink2) ] || null;\n          } else {\n            variantId = termCfg.monthlyMap['Full Box'] || null;\n          }\n          sellingPlanId = termCfg.sellingPlanId;\n        }\n\n        return { variantId, sellingPlanId };\n      }\n\n      /* VIP popover handlers */\n      const vipInfoBtn = document.getElementById('vip-info-btn');\n      const vipPopover = document.getElementById('vip-popover');\n      const vipClose   = document.getElementById('vip-pop-close');\n      vipInfoBtn.addEventListener('click', e=>{ e.stopPropagation(); vipPopover.classList.toggle('open'); });\n      vipClose.addEventListener('click', ()=> vipPopover.classList.remove('open'));\n      document.addEventListener('click', e=>{ if(!vipPopover.contains(e.target) && e.target !== vipInfoBtn){ vipPopover.classList.remove('open'); }});\n      document.addEventListener('keydown', e=>{ if(e.key==='Escape'){ vipPopover.classList.remove('open'); }});\n\n      /* Add to cart */\n      document.getElementById('back-2').addEventListener('click', ()=> setActiveStep(2));\n      document.getElementById('add-to-cart').addEventListener('click', ()=>{\n        try{\n          if(!state.tier){ alert('Please choose a tier.'); return; }\n          if(state.tier==='one' && !state.drink1){ alert('Please choose your drink.'); return; }\n          if(state.tier==='two' && (!state.drink1 || !state.drink2)){ alert('Please choose both drinks.'); return; }\n\n          const choice = getVariantAndPlan();\n          if(!choice || !choice.variantId || !choice.sellingPlanId){\n            alert('Variant/selling plan is not configured for this selection yet.');\n            return;\n          }\n\n          const props =\n            state.tier==='two'   ? { 'Drink One': state.drink1, 'Drink Two': state.drink2 } :\n            state.tier==='three' ? { 'Drink One': 'Coffee', 'Drink Two': 'Tea', 'Drink Three': 'Drinking Chocolate' } :\n                                    { 'Drink Selection': state.drink1 };\n\n          const items = [{ id:Number(choice.variantId), quantity:1, selling_plan:Number(choice.sellingPlanId), properties:props }];\n\n          const vipToggle = document.getElementById('vip-toggle');\n          if(vipToggle && vipToggle.checked){\n            items.push({ id:Number(CONFIG.vip.variantId), quantity:1, selling_plan:Number(CONFIG.vip.sellingPlanId) });\n          }\n\n          fetch('/cart/add.js',{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ items }) })\n            .then(()=>{ openCartDrawer(); })\n            .catch(()=>{ location.href = buildLinkFallback(); });\n        }catch(err){ console.error(err); location.href = buildLinkFallback(); }\n      });\n\n      function buildLinkFallback(){\n        const choice = getVariantAndPlan();\n        const vipToggle = document.getElementById('vip-toggle');\n        const url = new URL(location.origin + '/cart/add');\n        if(choice){\n          url.searchParams.append('items[0][id]', choice.variantId);\n          url.searchParams.append('items[0][quantity]', '1');\n          url.searchParams.append('items[0][selling_plan]', choice.sellingPlanId);\n        }\n        if(vipToggle && vipToggle.checked){\n          url.searchParams.append('items[1][id]', CONFIG.vip.variantId);\n          url.searchParams.append('items[1][quantity]', '1');\n          url.searchParams.append('items[1][selling_plan]', CONFIG.vip.sellingPlanId);\n        }\n        return url.toString();\n      }\n\n      attachToggleHandlers();\n      setActiveStep(1);\n    });\n  </script>\n</body>\n</html>",
        "color_scheme": "scheme-1",
        "padding_top": 40,
        "padding_bottom": 52
      }
    }
  },
  "order": [
    "main",
    "custom_liquid_yxKzpk"
  ]
}
